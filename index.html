<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dead Frontier 2 Raid Guide Builder</title>
  <style>
    body { font-family: Arial, sans-serif; display: flex; margin: 0; }
    #sidebar { width: 250px; background: #f4f4f4; padding: 10px; overflow-y: auto; }
    #main { flex: 1; padding: 10px; }
    .category { border: 1px solid #ccc; margin-bottom: 5px; border-radius: 5px; }
    .category h3 { margin: 0; padding: 5px; background: #ddd; cursor: move; }
    .content { padding: 5px; display: none; }
    .active .content { display: block; }
    button { margin: 2px; }
    #guideOutput { white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; min-height: 200px; }
    li { list-style-type: none; padding: 2px; }
    li:hover { background: #ffe6e6; }
  </style>
</head>
<body>
  <div id="sidebar"></div>
  <div id="main">
    <div>
      <label for="floorSelect">Floor:</label>
      <select id="floorSelect"></select>
      <label for="sectionInput">Section:</label>
      <input id="sectionInput" placeholder="Enter section name">
    </div>
    <div>
      <label for="currentPath">Current Path:</label>
      <input id="currentPath" readonly>
    </div>
    <div id="guideOutput"></div>
  </div>

  <script>
    const guide = {};
    let currentPath = [];
    let lastBoss = null;

    // Escape key bug fix
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape") {
        e.preventDefault();
      }
    });

    // Categories
    const categories = [
      { name: "Turns", buttons: ["TL","TR"] },
      { name: "Hallways", buttons: ["H"] },
      { name: "Doors", buttons: ["LDD","RDD","LSD","RSD","DDA","SDA","RDDA","LDDA","RSDA","LSDA"] },
      { name: "Keys", buttons: ["BIG","SMALL","ORNATE","RUSTY","BRASS","IRON"] },
      { name: "Keycards", buttons: ["RED","ORANGE","BLUE","PINK","PURPLE","BLACK","WHITE","GREEN","YELLOW"] },
      { name: "Bosses", buttons: ["Titan","Tendril","Choir","Finger Head","Reaper","Spider","Spitter","Twin","Creep","Hysteric","Cultist"] },
      { name: "Mutations", buttons: ["Cystic","Optic","Spined","Scythed","Tentacled"] },
      { name: "Items/Notes", customInput: true },
      { name: "Actions", special: true }
    ];

    // Build sidebar
    const sidebar = document.getElementById("sidebar");
    categories.forEach(cat => {
      const div = document.createElement("div");
      div.className = "category";
      const header = document.createElement("h3");
      header.textContent = cat.name;
      header.addEventListener("click", ()=> div.classList.toggle("active"));
      div.appendChild(header);

      const content = document.createElement("div");
      content.className = "content";

      if (cat.buttons) {
        cat.buttons.forEach(b => {
          const btn = document.createElement("button");
          btn.textContent = b;
          btn.addEventListener("click", ()=> addToken(b, cat.name));
          content.appendChild(btn);
        });
      }

      if (cat.customInput) {
        const inp = document.createElement("input");
        inp.placeholder = "Enter note/item";
        inp.addEventListener("keydown", e => {
          if (e.key === "Enter" && inp.value.trim()) {
            addToken(inp.value.trim(), cat.name);
            inp.value = "";
          }
        });
        content.appendChild(inp);
      }

      if (cat.special) {
        content.appendChild(makeBtn("Undo", undo));
        content.appendChild(makeBtn("Undo Last Entry", undoEntry));
        content.appendChild(makeBtn("Clear Input", clearInput));
        content.appendChild(makeBtn("Clear Guide", clearGuide));
      }

      div.appendChild(content);
      sidebar.appendChild(div);
    });

    // Floors
    const floorSelect = document.getElementById("floorSelect");
    for (let i=1;i<=20;i++) {
      const opt = document.createElement("option");
      opt.value = i+"F";
      opt.textContent = i+"F";
      floorSelect.appendChild(opt);
    }

    function makeBtn(label, handler) {
      const btn = document.createElement("button");
      btn.textContent = label;
      btn.addEventListener("click", handler);
      return btn;
    }

    function addToken(token, category) {
      if (["Bosses","Mutations"].includes(category)) {
        if (category==="Bosses") {
          lastBoss = token;
          addEntry(token);
        } else if (category==="Mutations" && lastBoss) {
          addEntry(`${lastBoss} (${token})`);
          lastBoss = null;
        }
      } else {
        const floor = floorSelect.value;
        addEntry(`${floor} ${token}`);
      }
    }

    function addEntry(entry) {
      const section = document.getElementById("sectionInput").value || "General";
      if (!guide[section]) guide[section] = [];
      guide[section].push(entry);
      renderGuide();
    }

    function undo() {
      currentPath.pop();
      document.getElementById("currentPath").value = currentPath.join("-");
    }

    function undoEntry() {
      const sections = Object.keys(guide);
      for (let i = sections.length - 1; i >= 0; i--) {
        const sec = sections[i];
        if (guide[sec] && guide[sec].length > 0) {
          guide[sec].pop();
          renderGuide();
          return;
        }
      }
      alert("Nothing to undo â€” the guide is empty.");
    }

    function clearInput() {
      currentPath = [];
      document.getElementById("currentPath").value = "";
    }

    function clearGuide() {
      if (confirm("Clear entire guide?")) {
        for (let k in guide) guide[k] = [];
        renderGuide();
      }
    }

    function renderGuide() {
      const output = document.getElementById("guideOutput");
      output.innerHTML = "";

      for (const section in guide) {
        if (guide[section].length === 0) continue;

        const sectionHeader = document.createElement("h3");
        sectionHeader.textContent = section;
        output.appendChild(sectionHeader);

        const list = document.createElement("ul");
        guide[section].forEach((entry, index) => {
          const li = document.createElement("li");
          li.textContent = entry;

          li.style.cursor = "pointer";
          li.title = "Click to remove this entry";

          li.addEventListener("click", () => {
            if (confirm(`Remove this entry?\n\n${entry}`)) {
              guide[section].splice(index, 1);
              renderGuide();
            }
          });

          list.appendChild(li);
        });

        output.appendChild(list);
      }
    }
  </script>
</body>
</html>
